<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>INF402 - Futoshiki</title>
    <link rel="stylesheet" href="style.css"/>

    <script type="application/javascript" src="lib/jquery-3.4.1.js"></script>
    <script type="application/javascript" src="lib/minisat.js"></script>
    <script type="application/javascript" src="futoshiki.js"></script>
    <script type="application/javascript">
        const CELL_VALUES = ['0','1','2','3','4'];
        const OPERATOR_VALUES = ['0','&lt;','&gt;'];


        jQuery(function() {
            function update_rpl() {
                let rpl = '';
                const $all_cells = jQuery('td.cell');
                jQuery.each($all_cells,function(index,td) {
                    const $td = jQuery(td);
                    const value = $td.text();
                    if (value != '0') {
                        const square = td.id;
                        rpl = rpl + square + value + '\n';
                    }
                });

                const $all_operators = jQuery('td.operator');
                jQuery.each($all_operators,function(index,td) {
                    const $td = jQuery(td);
                    const value = $td.text();
                    if (value != '0') {
                        const squares = td.id.split('');

                        rpl = rpl + squares.join(value) + '\n';
                    }
                });

                const $rpl = jQuery('#rpl');
                $rpl.html(rpl);
            }

            const $all_cells = jQuery('td.cell');
            $all_cells.html(CELL_VALUES[0]);
            $all_cells.click(function(event) {
                const $target = jQuery(event.target);
                const index = CELL_VALUES.indexOf($target.html());
                $target.html(CELL_VALUES[(index+1)%5]);
                update_rpl();
            });

            const $all_operators = jQuery('td.operator');
            $all_operators.html(OPERATOR_VALUES[0]);
            $all_operators.click(function(event) {
                const $target = jQuery(event.target);
                const index = OPERATOR_VALUES.indexOf($target.html());
                $target.html(OPERATOR_VALUES[(index+1)%3]);
                update_rpl();
            });

            jQuery('button').click(function() {
                const $textarea = jQuery('#rpl');
                const rpl = $textarea.val().split('\n');
                const dimacs = rpl2dimacs(rpl);
                const solution_as_dimacs = solve(dimacs);
                const solution_as_array = dimacs2pretty(solution_as_dimacs);
                const $body = jQuery('body');
                const $table=jQuery('<table>');
                $table.append(solution_as_array.map(r=>'<tr>'+(r.map(c=>`<td>${c}</td>`))+'</tr>'))
                $body.append($table);
            });
        });
    </script>
</head>
<body>
<h2>Futoshiki</h2>

<table>
    <tr>
        <td id="A" class="cell">0</td>
        <td id="AB" class="horizontal operator">0</td>
        <td id="B" class="cell">0</td>
        <td id="BC" class="horizontal operator">0</td>
        <td id="C" class="cell">0</td>
        <td id="CD" class="horizontal operator">0</td>
        <td id="D" class="cell">0</td>
    </tr>
    <tr>
        <td id="AE" class="vertical operator">0</td>
        <td class="spacer"></td>
        <td id="BF" class="vertical operator">0</td>
        <td class="spacer"></td>
        <td id="CG" class="vertical operator">0</td>
        <td class="spacer"></td>
        <td id="DH" class="vertical operator">0</td>
    </tr>
    <tr>
        <td id="E" class="cell">0</td>
        <td id="EF" class="horizontal operator">0</td>
        <td id="F" class="cell">0</td>
        <td id="FG" class="horizontal operator">0</td>
        <td id="G" class="cell">0</td>
        <td id="GH" class="horizontal operator">0</td>
        <td id="H" class="cell">0</td>
    </tr>
    <tr>
        <td id="EI" class="vertical operator">0</td>
        <td class="spacer"></td>
        <td id="FJ" class="vertical operator">0</td>
        <td class="spacer"></td>
        <td id="GK" class="vertical operator">0</td>
        <td class="spacer"></td>
        <td id="HL" class="vertical operator">0</td>
    </tr>
    <tr>
        <td id="I" class="cell">0</td>
        <td id="IJ" class="horizontal operator">0</td>
        <td id="J" class="cell">0</td>
        <td id="JK" class="horizontal operator">0</td>
        <td id="K" class="cell">0</td>
        <td id="KL" class="horizontal operator">0</td>
        <td id="L" class="cell">0</td>
    </tr>
    <tr>
        <td id="IM" class="vertical operator">0</td>
        <td class="spacer"></td>
        <td id="JN" class="vertical operator">0</td>
        <td class="spacer"></td>
        <td id="KO" class="vertical operator">0</td>
        <td class="spacer"></td>
        <td id="LP" class="vertical operator">0</td>
    </tr>
    <tr>
        <td id="M" class="cell">0</td>
        <td id="MN" class="horizontal operator">0</td>
        <td id="N" class="cell">0</td>
        <td id="NO" class="horizontal operator">0</td>
        <td id="O" class="cell">0</td>
        <td id="OP" class="horizontal operator">0</td>
        <td id="P" class="cell">0</td>
    </tr>

</table>

<textarea id="rpl" rows="5"></textarea>
<button>RUN</button>
<hr>
</body>
</html>